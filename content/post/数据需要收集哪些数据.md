+++
title = "数据需要收集哪些数据"
draft = true
date = "2017-06-15"
Categories = ["AkiRoss"] 
Description = "" 
Tags = ["埋点","ad"] 
toc = true

+++


## 背景

最近线上遇到一些问题，分析起来还是要抓瞎，完全不知道怎么去定位。只能从代码去分析...觉得之前的设计的数据收集太简单了，只是以报表需求为导向设计的。那我们还需要收集哪些数据呢？

## 能解释业务的数据

### 所有业务要串起来

业务有三条线：
- Active
- Config
- Preload->Impression->Event->Click->Install

改动：

- 最核心的广告生命周期是否可以用一个Id呢？如果不能，每一步要讲上一步的id给带上来。

- CDN的下载要带上一个preloadId，然后开启参数过滤，通过关联preloadId将下载流程也关联到核心业务上去。

- 重复Id上报的问题


### Server日志

- ELK要用起来，亦可以调研一下阿里的日志服务
- 规范Server输出，尤其是Filter广告时候，要将挑选广告失败的原因记录到日志里面

## 每个客户端的行为都是可追溯的
最近两个痛点，一个是流量说我们的填充率对不上，另外一个点击广告主上报跟服务器上报总是对不上。
- APP对SDK的接口调用都要记录
- SDK和Server之外的所有交互（点击上报，CDN下载）都要记录
- 以上记录可以通过开关来控制
- EndCard的点击率要能区分点击区域，找到真实的点击率

## 其他数据
抓友商的包，发现友商有一个SessionStart和SessionEnd的接口，这个要加上。貌似SessionEnd不准，因为每次进入后台，SDK没有机会发请求到Server。

## 实施

### AB测试准备
增加一个Header`x-clad-tag`,在Config接口下发下去，给用户打标签，并贯彻到整个业务流程

### 上报
Impr,Click等事件上报因为只是记一个数字，要和Server业务分开，避免互相干扰，并且这些地址应该是Preload下发下去，这样易于控制，甚至以后可以作弊，好吧，官方的说法应该按照某人的所说："`我们不主动作恶，但是在环境恶劣的时候，要有保护自己的手段。`"



